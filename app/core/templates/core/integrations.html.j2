{% extends "core/base.html.j2" %}

{% block title %}Integrations - {{ organization.name }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center">
                <a href="{% url 'core:dashboard' %}"
                   class="mr-4 text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </a>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Integrations</h1>
                    <p class="mt-2 text-sm text-gray-600">Connect {{ organization.name }} with your favorite services</p>
                </div>
            </div>
        </div>

        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="mb-6 p-4 rounded-md {% if message.tags == 'error' %}bg-red-50 border border-red-200{% else %}bg-green-50 border border-green-200{% endif %}">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            {% if message.tags == 'error' %}
                                <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                            {% else %}
                                <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            {% endif %}
                        </div>
                        <div class="ml-3">
                            <p class="text-sm {% if message.tags == 'error' %}text-red-700{% else %}text-green-700{% endif %}">
                                {{ message }}
                            </p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Available Integrations -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-medium text-gray-900">Available Integrations</h2>
                <p class="mt-1 text-sm text-gray-500">Connect external services to receive webhooks and notifications</p>
            </div>

            <div class="divide-y divide-gray-200">
                {% for integration in available_integrations %}
                    <div class="px-6 py-6">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <!-- Integration Icon -->
                                <div class="flex-shrink-0">
                                    {% if integration.type == 'slack_notifications' %}
                                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-6 h-6 text-purple-600" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52-2.523A2.528 2.528 0 0 1 5.042 10.12h2.52v2.522a2.528 2.528 0 0 1-2.52 2.523Zm0-6.802A2.528 2.528 0 0 1 2.522 5.84a2.528 2.528 0 0 1 2.52-2.523 2.528 2.528 0 0 1 2.52 2.523v2.523H5.042Zm6.802 0a2.528 2.528 0 0 1-2.523-2.523A2.528 2.528 0 0 1 11.844 3.317a2.528 2.528 0 0 1 2.523 2.523v2.523h-2.523Zm0 6.802a2.528 2.528 0 0 1 2.523 2.523 2.528 2.528 0 0 1-2.523 2.523 2.528 2.528 0 0 1-2.523-2.523v-2.523h2.523Z"/>
                                            </svg>
                                        </div>
                                    {% elif integration.type == 'shopify' %}
                                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M15.337 1.317c-.133-.077-.266-.125-.42-.144-.036-.006-.072-.006-.108-.012-.072-.018-.144-.024-.216-.024-.265 0-.516.054-.75.152-.012.006-.024.006-.036.012C13.452.979 13.141.656 12.758.346c-.6-.48-1.32-.72-2.004-.72-.024 0-.054 0-.078.006-.048-.048-.102-.096-.162-.138C9.984-.75 9.348-1.017 8.628-1.017c-1.242 0-2.628.768-3.702 2.064C3.882 2.547 3.318 4.146 3.156 6.066L.306 6.906c-.906.264-1.242.36-1.398.786-.138.384-.996 7.572-1.098 8.334l.006.006 11.076 2.046c.012-.006.024-.006.036-.012l5.718-1.254s.012-.006.018-.012l.006-.006c.024-.012.048-.03.072-.048l.036-.024c.018-.018.036-.036.048-.054.018-.024.036-.048.048-.072.012-.024.018-.048.024-.078.006-.024.006-.048.006-.072v-.012c0-.018-.006-.036-.006-.054l-1.632-13.098c-.054-.408-.192-.672-.426-.804zM8.628-.42c.426 0 .816.156 1.146.402.102.078.192.162.276.252-.42.198-.876.432-1.38.714-.984.552-2.118 1.302-3.186 2.292C5.106 4.422 4.746 5.862 4.686 7.518L2.154 8.226c.396-3.456 2.064-5.994 3.552-7.032.546-.384 1.188-.606 1.902-.606h.02zm1.65.924c.318-.168.618-.318.912-.456.228-.108.456-.204.684-.294.132.168.258.348.384.546.318.504.576 1.044.768 1.596.204.594.348 1.2.426 1.794l-3.078.876c-.012-1.572-.324-2.766-.696-3.612-.234-.516-.462-.936-.642-1.254.084-.066.168-.132.252-.198zm2.718-1.2c.132-.048.264-.09.396-.126.126-.036.252-.066.378-.09-.318.252-.636.546-.948.882-.312.336-.612.708-.894 1.11-.282.402-.546.84-.78 1.314-.234.474-.438.978-.606 1.524l-3.078.876c-.072-.456-.186-.912-.336-1.356-.15-.444-.342-.876-.576-1.284-.234-.408-.516-.798-.846-1.152-.33-.354-.708-.672-1.128-.942.132-.156.276-.306.426-.45.372-.354.78-.678 1.224-.942.444-.264.924-.474 1.422-.636.498-.162 1.014-.276 1.536-.348.522-.072 1.044-.09 1.548-.072.504.018.996.078 1.464.186.468.108.918.264 1.35.468-.144.054-.288.114-.432.18zm7.116 1.764c-.144-.84-.426-1.536-.822-2.064-.396-.528-.912-.816-1.512-.816-.006 0-.018 0-.024 0-.6.006-1.188.306-1.734.822-.546.516-1.032 1.236-1.434 2.106-.402.87-.714 1.872-.918 2.958-.204 1.086-.294 2.244-.258 3.396l-3.078.876c-.048-.744-.042-1.482.018-2.202.06-.72.186-1.422.378-2.088.192-.666.45-1.296.774-1.872.324-.576.714-1.086 1.164-1.512.45-.426.96-.756 1.524-.972.564-.216 1.182-.312 1.836-.276.654.036 1.35.228 2.088.576z"/>
                                            </svg>
                                        </div>
                                    {% elif integration.type == 'stripe_customer' %}
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.274 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"/>
                                            </svg>
                                        </div>
                                    {% else %}
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                            </svg>
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Integration Details -->
                                <div class="ml-4">
                                    <div class="flex items-center">
                                        <h3 class="text-lg font-medium text-gray-900">{{ integration.name }}</h3>
                                        {% if integration.connected %}
                                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                Connected
                                            </span>
                                        {% else %}
                                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                Available
                                            </span>
                                        {% endif %}
                                    </div>
                                    <p class="mt-1 text-sm text-gray-500">{{ integration.description }}</p>
                                </div>
                            </div>

                            <!-- Action Button -->
                            <div class="ml-4">
                                {% if integration.connected %}
                                    <button type="button"
                                            class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition duration-150 ease-in-out">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        Manage
                                    </button>
                                {% else %}
                                    {% if integration.type == 'slack_notifications' %}
                                        <a href="{% url 'core:integrate_slack' %}"
                                           class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition duration-150 ease-in-out">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            </svg>
                                            Connect
                                        </a>
                                    {% elif integration.type == 'shopify' %}
                                        <a href="{% url 'core:integrate_shopify' %}"
                                           class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition duration-150 ease-in-out">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            </svg>
                                            Connect
                                        </a>
                                    {% else %}
                                        <button type="button" disabled
                                                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-400 bg-gray-100 cursor-not-allowed">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            </svg>
                                            Coming Soon
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Webhook Information -->
        <div class="mt-8 bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-medium text-gray-900">Webhook Information</h2>
                <p class="mt-1 text-sm text-gray-500">Your organization's webhook endpoints</p>
            </div>
            <div class="px-6 py-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Organization Webhook Token</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <div class="relative flex items-stretch flex-grow focus-within:z-10">
                                <input type="text" readonly
                                       value="{{ organization.uuid }}"
                                       class="block w-full rounded-none rounded-l-md border-gray-300 bg-gray-50 text-sm text-gray-600">
                            </div>
                            <button type="button" onclick="copyToClipboard('{{ organization.uuid }}')"
                                    class="relative -ml-px inline-flex items-center space-x-2 rounded-r-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                <span>Copy</span>
                            </button>
                        </div>
                        <p class="mt-2 text-sm text-gray-500">
                            Use this token in your webhook URLs: <code class="text-xs bg-gray-100 px-1 py-0.5 rounded">/webhook/customer/{{ organization.uuid }}/&lt;provider&gt;/</code>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Section -->
        <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">Need Help?</h3>
                    <div class="mt-2 text-sm text-blue-700">
                        <p>Each integration requires specific setup:</p>
                        <ul class="mt-1 list-disc list-inside">
                            <li><strong>Slack:</strong> Connect your workspace to receive notifications</li>
                            <li><strong>Shopify:</strong> Configure webhooks in your Shopify admin</li>
                            <li><strong>Stripe:</strong> Set up customer payment webhooks</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Could add a toast notification here
        alert('Copied to clipboard!');
    });
}
</script>
{% endblock %}